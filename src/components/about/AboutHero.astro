---
import HeroBackgroundSlider from "../home/HeroBackgroundSlider";

// Hero para la página Sobre Korvalia
const API_BASE = import.meta.env.PUBLIC_API_URL || "http://localhost:4000";

// Valores por defecto
let heroTitle = "Te ayudamos a buscar tu nuevo hogar";
let heroImages: Array<{ id: number; url: string; order: number }> = [];

// Cargar datos del backend
try {
  // Cargar título desde pages/about
  const pageResponse = await fetch(`${API_BASE}/api/pages/about`);
  if (pageResponse.ok) {
    const pageData = await pageResponse.json();
    if (pageData.data?.title) {
      heroTitle = pageData.data.title;
    }
  }

  // Cargar imágenes del hero desde hero-images
  const heroImagesRes = await fetch(`${API_BASE}/api/hero-images?pageKey=about`);
  if (heroImagesRes.ok) {
    const imagesData = await heroImagesRes.json();
    heroImages = (imagesData.data || []).filter((img: any) => img.active).sort((a: any, b: any) => a.order - b.order);
  }
} catch (error) {
  console.error("Error al cargar datos del hero:", error);
}

// Si no hay imágenes, usar imagen por defecto
const slides =
  heroImages.length > 0
    ? heroImages
    : [
        {
          id: 0,
          url: "https://images.unsplash.com/photo-1560518883-ce09059eeffa?w=1920&h=800&fit=crop&q=80",
          order: 0,
        },
      ];
---

<section class="about-hero">
  <div class="hero-background">
    <HeroBackgroundSlider slides={slides} interval={3500} client:load />
    <div class="hero-overlay"></div>
  </div>

  <div class="hero-content">
    <div class="container">
      <h1 class="hero-title">{heroTitle}</h1>
    </div>
  </div>
</section>

<style>
  .about-hero {
    position: relative;
    height: 820px;
    display: flex;
    align-items: center;
    justify-content: center;
    overflow: hidden;
  }

  .hero-background {
    position: absolute;
    inset: 0;
    z-index: 0;
  }

  .hero-overlay {
    position: absolute;
    inset: 0;
    background: rgba(0, 0, 0, 0.4);
    z-index: 1;
  }

  .hero-content {
    position: relative;
    z-index: 10;
    width: 100%;
  }

  .container {
    max-width: 1200px;
    margin: 0 auto;
    padding: 0 1.5rem;
    text-align: center;
  }

  .hero-title {
    font-family: "Montserrat", system-ui, sans-serif;
    font-size: 2.5rem;
    font-weight: 600;
    color: white;
    margin: 0;
    line-height: 1.3;
  }

  @media (max-width: 768px) {
    .about-hero {
      height: 420px;
    }

    .hero-title {
      font-size: 1.9rem;
    }
  }
</style>
