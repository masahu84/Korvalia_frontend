---
// Imagen grande + galería de casas - Contenido dinámico desde el backend
const API_BASE = import.meta.env.PUBLIC_API_URL || "http://localhost:4000";

// Helper para construir URLs completas de imágenes
function getImageUrl(url: string): string {
  if (!url) return "";
  if (url.startsWith("http://") || url.startsWith("https://")) {
    return url;
  }
  return url.startsWith("/") ? `${API_BASE}${url}` : `${API_BASE}/${url}`;
}

// Valores por defecto
let mainImage = "https://images.unsplash.com/photo-1586023492125-27b2c045efd7?w=1200&h=600&fit=crop&q=80";
let galleryImages = [
  "https://images.unsplash.com/photo-1600585154340-be6161a56a0c?w=400&h=300&fit=crop",
  "https://images.unsplash.com/photo-1568605114967-8130f3a36994?w=400&h=300&fit=crop",
  "https://images.unsplash.com/photo-1605146769289-440113cc3d00?w=400&h=300&fit=crop",
  "https://images.unsplash.com/photo-1600596542815-ffad4c1539a9?w=400&h=300&fit=crop",
  "https://images.unsplash.com/photo-1583608205776-bfd35f0d9f83?w=400&h=300&fit=crop",
  "https://images.unsplash.com/photo-1512917774080-9991f1c4c750?w=400&h=300&fit=crop",
];

// Cargar datos del backend
try {
  const response = await fetch(`${API_BASE}/api/pages/about`);
  if (response.ok) {
    const result = await response.json();
    const blocks = result.data?.blocks || {};

    if (blocks.showcase) {
      if (blocks.showcase.mainImage) {
        mainImage = getImageUrl(blocks.showcase.mainImage);
      }
      if (blocks.showcase.galleryImages && blocks.showcase.galleryImages.length > 0) {
        galleryImages = blocks.showcase.galleryImages.map((url: string) => getImageUrl(url));
      }
    }
  }
} catch (error) {
  console.error("Error al cargar datos de la galería:", error);
}
---

<section class="showcase-images">
  <div class="container">
    <!-- Imagen grande del interior -->
    <div class="main-image-wrapper">
      <img
        src={mainImage}
        alt="Interior Korvalia"
        class="main-image"
      />
    </div>

    <!-- Galería de casas -->
    {galleryImages.length > 0 && (
      <div class="gallery-grid">
        {galleryImages.map((img, index) => (
          <div class="gallery-item">
            <img
              src={img}
              alt={`Casa ${index + 1}`}
              class="gallery-image"
            />
          </div>
        ))}
      </div>
    )}
  </div>
</section>

<style>
  .showcase-images {
    padding: 2rem 0 4rem;
    background: white;
  }

  .container {
    max-width: 1200px;
    margin: 0 auto;
    padding: 0 1.5rem;
    display: flex;
    flex-direction: column;
    gap: 2rem;
  }

  .main-image-wrapper {
    width: 100%;
    border-radius: 12px;
    overflow: hidden;
    box-shadow: 0 8px 24px rgba(0, 0, 0, 0.12);
  }

  .main-image {
    width: 100%;
    height: auto;
    max-height: 500px;
    object-fit: cover;
    display: block;
  }

  .gallery-grid {
    display: grid;
    grid-template-columns: repeat(6, 1fr);
    gap: 1rem;
  }

  @media (max-width: 968px) {
    .gallery-grid {
      grid-template-columns: repeat(3, 1fr);
    }
  }

  @media (max-width: 640px) {
    .gallery-grid {
      grid-template-columns: repeat(2, 1fr);
    }
  }

  .gallery-item {
    border-radius: 8px;
    overflow: hidden;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
    transition: transform 0.2s;
  }

  .gallery-item:hover {
    transform: scale(1.05);
  }

  .gallery-image {
    width: 100%;
    height: 120px;
    object-fit: cover;
    display: block;
  }

  @media (max-width: 768px) {
    .showcase-images {
      padding: 1.5rem 0 3rem;
    }

    .gallery-image {
      height: 100px;
    }
  }
</style>
