---
// Sección de testimonio de cliente - Dinámico desde la base de datos
const API_BASE = import.meta.env.PUBLIC_API_URL || "http://localhost:4000";

// Valores por defecto
let testimonialName = "Merche Silva";
let testimonialRole = "La persona detrás de Korvalia";
let testimonialText = "Con más de 20 años de experiencia en el sector inmobiliario, mi objetivo es hacer que cada cliente encuentre no solo una propiedad, sino su verdadero hogar.\n\nCreo firmemente que cada casa tiene una historia y cada persona merece encontrar el lugar perfecto donde escribir la suya.\n\nEn Korvalia, trabajamos con dedicación, transparencia y un compromiso genuino con tu satisfacción.";
let testimonialImage = "https://images.unsplash.com/photo-1494790108377-be9c29b29330?w=300&h=300&fit=crop&q=80";

try {
  const response = await fetch(`${API_BASE}/api/pages/home`);
  if (response.ok) {
    const result = await response.json();
    const data = result.data || {};

    if (data.testimonialName) {
      testimonialName = data.testimonialName;
    }
    if (data.testimonialRole) {
      testimonialRole = data.testimonialRole;
    }
    if (data.testimonialText) {
      testimonialText = data.testimonialText;
    }
    if (data.testimonialImage) {
      // Construir URL completa de la imagen
      if (data.testimonialImage.startsWith("http://") || data.testimonialImage.startsWith("https://")) {
        testimonialImage = data.testimonialImage;
      } else {
        testimonialImage = data.testimonialImage.startsWith("/")
          ? `${API_BASE}${data.testimonialImage}`
          : `${API_BASE}/${data.testimonialImage}`;
      }
    }
  }
} catch (error) {
  console.error("Error al cargar testimonial:", error);
}

// Convertir el texto en párrafos (separados por saltos de línea)
const paragraphs = testimonialText.split('\n').filter(p => p.trim());
---

<section class="testimonial">
  <div class="container">
    <div class="testimonial-content">
      <!-- Foto circular -->
      <div class="testimonial-image">
        <img
          src={testimonialImage}
          alt={testimonialName}
          class="avatar"
        />
      </div>

      <!-- Contenido del testimonio -->
      <div class="testimonial-text">
        <h2 class="testimonial-name">{testimonialName}</h2>
        <p class="testimonial-role">{testimonialRole}</p>

        <div class="testimonial-description">
          {paragraphs.map(paragraph => (
            <p>{paragraph}</p>
          ))}
        </div>
      </div>
    </div>
  </div>
</section>

<style>
  .testimonial {
    padding: 5rem 0;
    background: #ffffff;
  }

  .container {
    max-width: 1000px;
    margin: 0 auto;
    padding: 0 1.5rem;
  }

  .testimonial-content {
    display: grid;
    grid-template-columns: auto 1fr;
    gap: 3rem;
    align-items: center;
  }

  @media (max-width: 768px) {
    .testimonial-content {
      grid-template-columns: 1fr;
      text-align: center;
      gap: 2rem;
    }

    .testimonial-image {
      justify-self: center;
    }
  }

  .testimonial-image {
    position: relative;
  }

  .avatar {
    width: 180px;
    height: 180px;
    border-radius: 50%;
    object-fit: cover;
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
  }

  @media (max-width: 768px) {
    .avatar {
      width: 140px;
      height: 140px;
    }
  }

  .testimonial-text {
    flex: 1;
  }

  .testimonial-name {
    font-family: "Montserrat", system-ui, sans-serif;
    font-size: 2rem;
    font-weight: 600;
    color: #39505d;
    margin: 0 0 0.25rem 0;
  }

  .testimonial-role {
    font-size: 1.125rem;
    color: #133b34;
    font-weight: 500;
    margin: 0 0 1.5rem 0;
  }

  .testimonial-description {
    display: flex;
    flex-direction: column;
    gap: 1rem;
  }

  .testimonial-description p {
    font-size: 0.9375rem;
    line-height: 1.7;
    color: #6a8074;
    margin: 0;
  }

  @media (max-width: 768px) {
    .testimonial-name {
      font-size: 1.75rem;
    }

    .testimonial-role {
      font-size: 1rem;
    }

    .testimonial-description p {
      font-size: 0.875rem;
    }
  }
</style>
